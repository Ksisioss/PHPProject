{% extends 'base.html.twig' %}

{% block body %}
    <section class="event-list-section aspad">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-title">
                        <h2>UPCOMING GRAND PRIX</h2>
                    </div>
                </div>
            </div>
            {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                <div class="row mb-4">
                    <div class="col-lg-12 text-right">
                        <a href="{{ path('event_new') }}" class="primary-btn top-btn"><i class="fa fa-plus"></i> ADD NEW GRAND PRIX</a>
                    </div>
                </div>
            {% endif %}
            <div class="row mb-4">
                <div class="col-lg-12">
                    <form id="filter-form">
                        <div class="form-row">
                            <div class="col">
                                <input type="text" id="name-filter" class="form-control" placeholder="Search a Grand Prix">
                            </div>
                            <div class="col">
                                <input type="date" id="date-filter" class="form-control">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-12">
                    <div class="schedule-tab">
                        <div class="tab-content">
                                {% for event in events %}
                                    <div class="st-content event-card" data-title="{{ event.title }}" data-date="{{ event.date|date('Y-m-d') }}">
                                        <div class="container">
                                            <div class="row">
                                                <div class="col-lg-3">
                                                    <div class="sc-pic">
                                                        <img src="{{ asset('img/schedule/schedule-1.jpg') }}" alt="">
                                                    </div>
                                                </div>
                                                <div class="col-lg-5">
                                                    <div class="sc-text">
                                                        <h4>{{ event.title }}</h4>
                                                        <h6>{{ event.description }}</h6>
                                                    </div>
                                                </div>
                                                <div class="col-lg-4">
                                                    <ul class="sc-widget">
                                                        <li><i class="fa fa-clock-o"></i> {{ event.date|date('F j, Y, g:i a') }}</li>
                                                        <li><i class="fa fa-map-marker"></i> {{ event.location }}, {{ event.country }}</li>
                                                    </ul>
                                                    {% if is_granted('ROLE_USER') %}
                                                        {% set eventId = event.id %}
                                                        {% if eventRegistrations[eventId] is defined %}
                                                            <a href="{{ path('event_unregister', {'id': event.id}) }}" class="btn btn-sm btn-secondary" type="button">Se d√©sinscrire</a>
                                                        {% elseif isFull[event.id] > 0 %}
                                                            {{ isFull[event.id] }} places restantes
                                                            <a href="{{ path('event_register', {'id': event.id}) }}" class="btn btn-sm btn-secondary" type="button">S'inscrire</a>
                                                        {% endif %}
                                                        {% if is_granted('EVENT_DELETE', event) %}
                                                            <a href="{{ path('event_delete', {'id': event.id}) }}" onclick="return confirm('Are you sure you want to delete this event?');" class="btn btn-sm btn-danger" type="button">Supprimer</a>
                                                        {% endif %}
                                                        {% if is_granted('EVENT_EDIT', event) %}
                                                            <a href="{{ path('event_edit', {'id': event.id}) }}" class="btn btn-sm" type="button">Edit</a>
                                                        {% endif %}
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="pagination">
                {{ knp_pagination_render(events) }}
            </div>

        </div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const nameFilter = document.getElementById('name-filter');
            const dateFilter = document.getElementById('date-filter');
            const eventCards = document.querySelectorAll('.event-card');

            nameFilter.addEventListener('input', filterEvents);
            dateFilter.addEventListener('input', filterEvents);

            function filterEvents() {
                const nameValue = nameFilter.value.toLowerCase();
                const dateValue = dateFilter.value;

                eventCards.forEach(card => {
                    const title = card.getAttribute('data-title').toLowerCase();
                    const date = card.getAttribute('data-date');

                    const matchesName = title.includes(nameValue);
                    const matchesDate = date === dateValue || dateValue === '';

                    if (matchesName && matchesDate) {
                        card.style.display = 'block'; // or ''
                    } else {
                        card.style.display = 'none';
                    }
                });
            }
        });
    </script>
{% endblock %}
